---
title: 故障排除
layout: /src/layouts/autonum.astro
lastUpdated: 2025-05-18
---

:::tip[提示]
在本页上，按 `Ctrl`+`F` 搜索或查看右侧边栏以找到你的问题
:::

# 必读
## 环境变量的先决条件
:::note
我们已经在 `install.sh` 中给出了相关通知，但一些用户在提交问题时忽略了。
:::

环境变量 `$ILLOGICAL_IMPULSE_VIRTUAL_ENV` 必须正确设置，否则 AGS 配置将无法工作。

我们在 `~/.config/hypr/hyprland/env.conf` 中制作了默认配置，但你需要确保此配置文件包含在 `~/.config/hypr/hyprland.conf` 中。通常需要重启 Hyprland。

你可以运行 `./diagnose` 重新检查其值。

### 预期示例
```
[===diagnose===] declare -p ILLOGICAL_IMPULSE_VIRTUAL_ENV
declare -x ILLOGICAL_IMPULSE_VIRTUAL_ENV="/home/myself/.local/state/ags/.venv"
[---SUCCESS---]
```
其中 `myself` 代表实际用户名。

### 非预期示例 1
```
[===diagnose===] declare -p ILLOGICAL_IMPULSE_VIRTUAL_ENV
./diagnose: line 30: declare: ILLOGICAL_IMPULSE_VIRTUAL_ENV: not found
[---EXIT 1---]
```
对于上述情况：
- 很可能你仍在使用旧的 `~/.config/hypr/hyprland.conf`，并忘记将其内容替换为 `~/.config/hypr/hyprland.conf.new`。只需运行 `cd ~/.config/hypr;mv hyprland.conf{,.old};mv hyprland.conf{.new,}`。
- 确保你已重启 Hyprland。

### 非预期示例 2
```
[===diagnose===] declare -p ILLOGICAL_IMPULSE_VIRTUAL_ENV
declare -x ILLOGICAL_IMPULSE_VIRTUAL_ENV="\$XDG_STATE_HOME/ags/.venv"
[---SUCCESS---]
```
对于上述情况，`$XDG_STATE_HOME` 没有展开，这看起来很奇怪（可能是 Hyprland 的 bug？）。
- 确保在运行 `install.sh` 时，你没有跳过并正确执行了 `install-python-packages()`，这应该给你一个非空的 `~/.local/state/ags/.venv`。
- 你可以在 `~/.config/hypr/custom/env.conf` 中直接指定其值为：
```conf
env = ILLOGICAL_IMPULSE_VIRTUAL_ENV, /home/myself/.local/state/ags/.venv
```
并记得将 `myself` 替换为实际用户名。

## 你应该至少尝试一次的操作
- 重启 Hyprland，或重启你的系统，这对于应用环境变量更改是必要的。
- 如果与 AGS 相关的问题（即"栏"）有问题，通过按 `Super+Ctrl+T` 并在提示窗口中选择图片来切换壁纸。虽然不是 100% 有用，特别是当你的安装或环境变量一开始就出现问题时。

## 如何获取日志
- 如果某项有问题，打开终端（`Super`+`T`）并将其在 shell 中运行。查看可能有问题的错误/警告。
- 桌面栏、侧边栏、快捷键速查表等由 AGS 提供支持。（提示：不是 waybar。）打开终端并运行 `pkill agsv1; agsv1`。

## 其他信息
- 在此 wiki 中搜索（特别是本页），以及现有的 [issues](https://github.com/end-4/dots-hyprland/issues) 和 [discussions](https://github.com/end-4/dots-hyprland/discussions)。
- 使用一些常识。如果你无法解决，请[打开讨论](https://github.com/end-4/dots-hyprland/discussions)寻求帮助。

# 一些问题及解决方案/变通方法
## AGS / 桌面栏主题/图标/CSS 出现问题/不工作
> 参考：[end-4/dots-hyprland#1010](https://github.com/end-4/dots-hyprland/issues/1010)

通过按 `Super+Ctrl+T` 并在提示窗口中选择图片来切换壁纸。

## 桌面/概览中某些应用程序图标缺失
> 参考：[end-4/dots-hyprland#497 comment](https://github.com/end-4/dots-hyprland/issues/497#issuecomment-2108212444) [end-4/dots-hyprland#487](https://github.com/end-4/dots-hyprland/issues/487)

请尝试以下解决方案/变通方法：
### 使用 `gsettings` 设置图标主题
:::note
这适用于以下情况：
- 应用程序窗口的类在图标主题 A 中有精确匹配的图标，但在主题 B 中没有。
- 你使用图标主题 B，这意味着在切换到图标主题 A 后问题会解决。
:::

例如 [Papirus](https://github.com/PapirusDevelopmentTeam/papirus-icon-theme)（推荐，因为它覆盖了很多应用程序）：
```sh
gsettings set org.gnome.desktop.interface icon-theme Papirus
```
当然你必须先安装它，对于 Arch Linux 使用 `sudo pacman -S papirus-icon-theme`。

### 在 AGS `user_options.jsonc` 中设置替换
:::note
这适用于以下情况：
- 应用程序有多种窗口类名（例如 `foot` 和 `footclient`），但只有一种（例如 `foot`）在当前图标主题中有精确匹配的图标。
- 你愿意对这些不同的窗口类使用相同的图标（例如 `foot` 和 `footclient` 使用相同的图标）。
:::

编辑 `~/.config/ags/user_options.jsonc`，在 `icons.substitutions` 中添加条目，例如：
```js
    'icons': {
        substitutions: {
            'footclient': "foot",
        },
    },
```

:::note
首次编辑此文件时，请先查看 `user_options.jsonc` 开头的说明。
:::

### 设置图标搜索路径
这适用于你有单独的图标文件。

在 `~/.config/ags/user_options.jsonc` 中适当修改 `icons.searchPaths`。

## 音乐控制不显示

> 参考：[end-4/dots-hyprland#168](https://github.com/end-4/dots-hyprland/issues/168)

- 确保你的播放器支持 Mpris（列表：[Arch Wiki 链接](https://wiki.archlinux.org/title/MPRIS)）
- 如果是浏览器，请安装 Plasma Integration 扩展：[Firefox](https://addons.mozilla.org/en-US/firefox/addon/plasma-integration/) 或 [Chromium](https://chrome.google.com/webstore/detail/plasma-integration/cimiefiiaegbelhefglklhhakcgmhkai) 和 `plasma-browser-integration`（这是 Arch 的）
  
然后，当 firefox 播放媒体时，运行以下命令
```bash
dbus-send --print-reply --dest=org.freedesktop.DBus /org/freedesktop/DBus org.freedesktop.DBus.ListNames|grep mpris
```
输出应包括
```plain
string "org.mpris.MediaPlayer2.plasma-browser-integration"
```
只有 "plasma-browser-integration" 名称才能工作。其他名称不行。

如果由于某种原因，firefox 仍然没有显示 dbus `org.mpris.MediaPlayer2.plasma-browser-integration`，
请考虑以下步骤：
1. 使用 `firefox --ProfileManager` 创建一个新配置文件。
2. 使用新配置文件启动 firefox 并重新安装 Plasma Integration 扩展。
3. 使用新配置文件重启 firefox 并再次尝试。
- _注意：`playerctl -F metadata` 也可能对调试有帮助。_

## 图标不显示。我看到奇怪的文本而不是图标。
- 你可能缺少 Material Symbols 字体。你可以手动下载字体并将其放在 `~/.local/share/fonts` 中
- 注意这是 Material <u>**Symbols**</u>，而不是 Material <u>**Icons**</u>！
- 记得运行 `fc-cache -fv` 刷新字体缓存。重启也可以。

## `loginctl lock-session` 无反应
> 参考：[end-4/dots-hyprland#278](https://github.com/end-4/dots-hyprland/issues/278)

根据 [Arch Linux 论坛上的这篇帖子](https://bbs.archlinux.org/viewtopic.php?pid=1311990#p1311990)：
> 需要监听 systemd-logind 的 dbus 信号才能工作。

Hypridle 能够成为这个"东西"，这意味着你应该确保它正在运行，
然后 `loginctl lock-session` 将向 hypridle 发送信号，
结果 hypridle 将通过执行其配置 `~/.config/hypr/hypridle.conf` 中定义的 `$lock_cmd` 来锁定屏幕。

参见 [Hyprland Wiki](https://wiki.hyprland.org/Hypr-Ecosystem/hypridle/#configuration) 获取更多信息。

## 终端：为什么我无法用 Ctrl+C 中断？
- 在 `foot` 中，Ctrl+C 被配置为复制文本。要中断，请使用 Ctrl+Shift+C
- 不想要这个？
  - 要删除此绑定：在 `~/.config/foot/foot.ini` 中，注释或删除包含 `clipboard-copy=Control+c` 的行
  - 如果你经常使用终端应用程序，使用功能更丰富的终端可能是个好主意

## 随机冻结
:::note
这与 illogical-impulse 技术上无关。
:::
参见 https://github.com/end-4/dots-hyprland/issues/746 。

# 已废弃的问题解决方案和变通方法
以下内容不再有用，因为情况已经改变。

仍保留在这里以防将来需要。

## AGS 安装失败
### `PermissionError: [Errno 13] Permission denied: '/usr/local/lib/libgvc.so'`
运行此命令检查该文件是否属于任何包（很可能是，因为它在 `/usr/local` 中）
```bash
pacman -Qo /usr/local/lib/libgvc.so
```
如果没有，那么删除它可能是安全的。为此，运行以下命令：
```bash
sudo mv /usr/local/lib/libgvc.so /tmp/
```

### 其他错误
删除 `./cache/ags` 并重新安装。

## Hyprland 安装失败
有时 AUR 包不会为你安装所有依赖项。Hyprland 总是在发展，当添加新内容时就会发生这种情况。
- 检查日志并查看它是否告诉你安装某些内容，然后尝试再次构建。
- 注意：你可能需要清除 `~/.cache/yay`。